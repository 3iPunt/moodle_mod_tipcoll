/**
 * @package
 * @author  2023 3iPunt <https://www.tresipunt.com/>
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_tipcoll/feedback",["jquery","core/str","core/ajax","core/templates"],(function($,Str,Ajax,Templates){let REGIONS_QUESTION='[data-region="mod-tipcoll-question"]',REGIONS_RESPONSE='[data-region="mod-tipcoll-response"]',ACTION_START='[data-action="start"]',ACTION_SEND_RESPONSE='[data-action="send_response"]',ACTION_SELECT_RESPONSE='[data-action="select_response"]',ACTION_NAV_ITEM='[data-region="nav-item"]',SERVICES_RESPONSE="mod_tipcoll_response_question_feedback";function Feedback(region,cmid){this.node=$(region+'[data-id="'+cmid+'"]'),this.cmid=cmid,this.setResponses(),this.node.find(ACTION_START).on("click",this.onStartClick.bind(this)),this.node.find(ACTION_NAV_ITEM).on("click",this.onStartClick.bind(this)),this.node.find(ACTION_SELECT_RESPONSE).on("click",this.onSelectResponseClick.bind(this)),this.node.find(ACTION_SEND_RESPONSE).on("click",this.onSendResponseClick.bind(this))}return Feedback.prototype.setResponses=function(e){let questions=this.node.find(REGIONS_QUESTION),quizs=[];questions.each((function(index){let quiz=$(this),qid=quiz.data("questionid"),resps=quiz.find(REGIONS_RESPONSE),responses=[];resps.each((function(index){let rid=$(this).data("responseid");responses.push(rid)}));let question={id:qid,responses:responses,select:null};quizs.push(question)})),this.responses=quizs},Feedback.prototype.updateStatus=function(e){let responsesCurrent=this.responses;this.node.find(REGIONS_QUESTION).each((function(index){let quiz=$(this),qid=quiz.data("questionid");quiz.find(REGIONS_RESPONSE).each((function(index){let resp=$(this),rid=resp.data("responseid");resp.removeClass("ok"),responsesCurrent.forEach((function(element,index,array){element.id===qid&&element.select===rid&&resp.addClass("ok")}))}))}));let already=!0;responsesCurrent.forEach((function(element,index,array){if(null===element.select)return already=!1,!0})),already&&this.node.find(ACTION_SEND_RESPONSE).removeAttr("disabled")},Feedback.prototype.onStartClick=function(e){this.node.find(ACTION_SEND_RESPONSE+'[data-id="'+this.cmid+'"]').show()},Feedback.prototype.onSelectResponseClick=function(e){let rid=$(e.currentTarget).data("responseid"),qid=$(e.currentTarget).data("questionid");this.responses.forEach((function(element,index,array){if(element.id===qid)return element.select=rid,$(e.currentTarget).addClass("ok"),!0})),this.updateStatus()},Feedback.prototype.getResponse=function(e){let response=[];return this.responses.forEach((function(element,index,array){response.push({qid:element.id,rid:element.select})})),response},Feedback.prototype.onSendResponseClick=function(e){this.node.find(ACTION_SEND_RESPONSE).attr("disabled");const response=this.getResponse(),request={methodname:SERVICES_RESPONSE,args:{cmid:this.cmid,response:response}};Ajax.call([request])[0].done((function(response){response.success?location.reload():console.log(response)})).fail((function(fail){console.log(fail)}))},Feedback.prototype.node=null,{initFeedback:function(region,cmid){return new Feedback(region,cmid)}}}));

//# sourceMappingURL=feedback.min.js.map