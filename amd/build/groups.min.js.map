{"version":3,"file":"groups.min.js","sources":["../src/groups.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package\n * @author  2023 3iPunt <https://www.tresipunt.com/>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* eslint-disable no-unused-vars */\n/* eslint-disable no-console */\n\ndefine([\n        'jquery',\n        'core/str',\n        'core/ajax',\n        'core/templates'\n    ], function ($, Str, Ajax, Templates) {\n        \"use strict\";\n\n        /**\n         *\n         */\n        let REGIONS = {\n            CONTENT: '[data-region=\"mod_tipcoll-content\"]',\n            QUESTION: '[data-region=\"mod-tipcoll-question\"]',\n            RESPONSE: '[data-region=\"mod-tipcoll-response\"]',\n        };\n\n        /**\n         *\n         */\n        let INPUT = {\n            GROUP_NAME: '#form-create-group #name'\n        };\n\n        /**\n         *\n         */\n        let ACTION = {\n            CREATE_GROUP: '[data-action=\"create-group\"]',\n            DELETE_GROUP: '[data-action=\"delete-group\"]',\n            ASSIGN_GROUP: '[data-action=\"assign-group\"]',\n            GROUP_NAME: '[data-input=\"group-name-create\"]',\n        };\n\n        /**\n         *\n         */\n        let SERVICES = {\n            CREATE: 'mod_tipcoll_group_create',\n            DELETE: 'mod_tipcoll_group_delete',\n            ASSIGN: 'mod_tipcoll_group_assign',\n        };\n\n        /**\n         * @param {String} region\n         * @param {Number} cmid\n         *\n         * @constructor\n         */\n        function Groups(region, cmid) {\n            this.node = $(region);\n            this.cmid = cmid;\n            this.node.find(INPUT.GROUP_NAME).on('keyup', this.onGroupNameChange.bind(this));\n            this.node.find(INPUT.GROUP_NAME).on('key', this.onGroupNameChange.bind(this));\n            this.node.find(ACTION.CREATE_GROUP).on('click', this.onCreateClick.bind(this));\n            this.node.find(ACTION.DELETE_GROUP).on('click', this.onDeleteClick.bind(this));\n            this.node.find(ACTION.ASSIGN_GROUP).on('change', this.onAssignClick.bind(this));\n        }\n\n        Groups.prototype.onGroupNameChange = function (e) {\n            if (e.which === 13 || e.which === 32) {\n                location.reload();\n            }\n            let groupname = $(INPUT.GROUP_NAME).val();\n            groupname = groupname.trim();\n            if (groupname.length > 3) {\n                this.node.find(ACTION.CREATE_GROUP).removeAttr('disabled');\n            } else {\n                this.node.find(ACTION.CREATE_GROUP).attr('disabled', true);\n            }\n        };\n\n        Groups.prototype.onCreateClick = function (e) {\n            this.node.find(ACTION.CREATE_GROUP).attr('disabled', true);\n\n            let groupname = $(INPUT.GROUP_NAME).val();\n            groupname = groupname.trim();\n\n            const request = {\n                methodname: SERVICES.CREATE,\n                args: {\n                    cmid: this.cmid,\n                    name: groupname\n                }\n            };\n            Ajax.call([request])[0].done(function(response) {\n                if (response.success) {\n                    location.reload();\n                } else {\n                    console.log(response);\n                }\n            }).fail(function(fail) {\n                console.log(fail);\n            });\n        };\n\n        Groups.prototype.onDeleteClick = function (e) {\n            $(e.currentTarget).attr('disabled', true);\n            let gid = $(e.currentTarget).data('groupid');\n\n            const request = {\n                methodname: SERVICES.DELETE,\n                args: {\n                    cmid: this.cmid,\n                    groupid: parseInt(gid)\n                }\n            };\n            Ajax.call([request])[0].done(function(response) {\n                if (response.success) {\n                    location.reload();\n                } else {\n                    console.log(response);\n                }\n            }).fail(function(fail) {\n                console.log(fail);\n            });\n        };\n\n        Groups.prototype.onAssignClick = function (e) {\n            let gid = $(e.currentTarget).val();\n            let uid = $(e.currentTarget).data('userid');\n\n            const request = {\n                methodname: SERVICES.ASSIGN,\n                args: {\n                    cmid: this.cmid,\n                    userid: parseInt(uid),\n                    groupid: parseInt(gid)\n                }\n            };\n            Ajax.call([request])[0].done(function(response) {\n                if (response.success) {\n                    location.reload();\n                } else {\n                    console.log(response);\n                }\n            }).fail(function(fail) {\n                console.log(fail);\n            });\n        };\n\n        /** @type {jQuery} The jQuery node for the region. */\n        Groups.prototype.node = null;\n\n        return {\n            /**\n             * Init\n             *\n             * @param {String} region\n             * @param {Number} cmid\n             *\n             * @return {Groups}\n             */\n            initGroups: function(region, cmid) {\n                return new Groups(region, cmid);\n            }\n        };\n    }\n);"],"names":["define","$","Str","Ajax","Templates","INPUT","ACTION","SERVICES","Groups","region","cmid","node","find","on","this","onGroupNameChange","bind","onCreateClick","onDeleteClick","onAssignClick","prototype","e","which","location","reload","groupname","val","trim","length","removeAttr","attr","request","methodname","args","name","call","done","response","success","console","log","fail","currentTarget","gid","data","groupid","parseInt","uid","userid","initGroups"],"mappings":";;;;;AAwBAA,4BAAO,CACC,SACA,WACA,YACA,mBACD,SAAUC,EAAGC,IAAKC,KAAMC,eAenBC,iBACY,2BAMZC,oBACc,+BADdA,oBAEc,+BAFdA,oBAGc,+BAOdC,gBACQ,2BADRA,gBAEQ,2BAFRA,gBAGQ,oCASHC,OAAOC,OAAQC,WACfC,KAAOV,EAAEQ,aACTC,KAAOA,UACPC,KAAKC,KAAKP,kBAAkBQ,GAAG,QAASC,KAAKC,kBAAkBC,KAAKF,YACpEH,KAAKC,KAAKP,kBAAkBQ,GAAG,MAAOC,KAAKC,kBAAkBC,KAAKF,YAClEH,KAAKC,KAAKN,qBAAqBO,GAAG,QAASC,KAAKG,cAAcD,KAAKF,YACnEH,KAAKC,KAAKN,qBAAqBO,GAAG,QAASC,KAAKI,cAAcF,KAAKF,YACnEH,KAAKC,KAAKN,qBAAqBO,GAAG,SAAUC,KAAKK,cAAcH,KAAKF,cAG7EN,OAAOY,UAAUL,kBAAoB,SAAUM,GAC3B,KAAZA,EAAEC,OAA4B,KAAZD,EAAEC,OACpBC,SAASC,aAETC,UAAYxB,EAAEI,kBAAkBqB,MACpCD,UAAYA,UAAUE,OAClBF,UAAUG,OAAS,OACdjB,KAAKC,KAAKN,qBAAqBuB,WAAW,iBAE1ClB,KAAKC,KAAKN,qBAAqBwB,KAAK,YAAY,IAI7DtB,OAAOY,UAAUH,cAAgB,SAAUI,QAClCV,KAAKC,KAAKN,qBAAqBwB,KAAK,YAAY,OAEjDL,UAAYxB,EAAEI,kBAAkBqB,MACpCD,UAAYA,UAAUE,aAEhBI,QAAU,CACZC,WAAYzB,gBACZ0B,KAAM,CACFvB,KAAMI,KAAKJ,KACXwB,KAAMT,YAGdtB,KAAKgC,KAAK,CAACJ,UAAU,GAAGK,MAAK,SAASC,UAC9BA,SAASC,QACTf,SAASC,SAETe,QAAQC,IAAIH,aAEjBI,MAAK,SAASA,MACbF,QAAQC,IAAIC,UAIpBjC,OAAOY,UAAUF,cAAgB,SAAUG,GACvCpB,EAAEoB,EAAEqB,eAAeZ,KAAK,YAAY,OAChCa,IAAM1C,EAAEoB,EAAEqB,eAAeE,KAAK,iBAE5Bb,QAAU,CACZC,WAAYzB,gBACZ0B,KAAM,CACFvB,KAAMI,KAAKJ,KACXmC,QAASC,SAASH,OAG1BxC,KAAKgC,KAAK,CAACJ,UAAU,GAAGK,MAAK,SAASC,UAC9BA,SAASC,QACTf,SAASC,SAETe,QAAQC,IAAIH,aAEjBI,MAAK,SAASA,MACbF,QAAQC,IAAIC,UAIpBjC,OAAOY,UAAUD,cAAgB,SAAUE,OACnCsB,IAAM1C,EAAEoB,EAAEqB,eAAehB,MACzBqB,IAAM9C,EAAEoB,EAAEqB,eAAeE,KAAK,gBAE5Bb,QAAU,CACZC,WAAYzB,gBACZ0B,KAAM,CACFvB,KAAMI,KAAKJ,KACXsC,OAAQF,SAASC,KACjBF,QAASC,SAASH,OAG1BxC,KAAKgC,KAAK,CAACJ,UAAU,GAAGK,MAAK,SAASC,UAC9BA,SAASC,QACTf,SAASC,SAETe,QAAQC,IAAIH,aAEjBI,MAAK,SAASA,MACbF,QAAQC,IAAIC,UAKpBjC,OAAOY,UAAUT,KAAO,KAEjB,CASHsC,WAAY,SAASxC,OAAQC,aAClB,IAAIF,OAAOC,OAAQC"}